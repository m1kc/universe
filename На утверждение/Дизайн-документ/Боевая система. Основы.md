# Боевая система. Основы
*В качестве первой версии данного документа был взят вики-документ [Боевая система. Основы](https://github.com/uonline/universe/wiki/%D0%91%D0%BE%D0%B5%D0%B2%D0%B0%D1%8F-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0.-%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D1%8B)*

## Характеристики персонажа
Персонаж игрока обладает рядом характеристик (параметров), которые учитываются в бою. Характеристики делятся на "основные", "дополнительные" и "вычисляемые".

### Основные
Характеристики значение которых расходуется в бою:

* **Здоровье** &mdash; показатель количества очков здоровья персонажа*. Очки здоровья тратятся при получении персонажем __урона__.
* **Мана** &mdash; показатель количества очков магической энергии персонажа*. Очки маны тратятся на использование __способностей__.
* **Энергия** &mdash; показатель количества очков выносливости персонажа*. Очки выносливости тратятся на совершение __действий__ в бою и переходы по локациям (?).

Здоровье, ману и энергию можно временно повысить тониками (здоровье, энергия) и камнями маны (мана). Значения данных характеристик можно восполнить соответствующими зельями.

### Дополнительные
Характеристики значение которых влияет на эффективность персонажа бою:

* **Сила** &mdash; показатель силы удара персонажа, мощи его атак. Влияет на наносимый персонажем с помощью оружия **урон**. *Повышается с использованием более продвинутого оружия (т.е. оружие увеличивает Силу персонажа?)*.
* **Защита** &mdash; показатель уровня защищенности персонажа. Чем выше защита, тем меньший урон получает персонаж. При высоком коэффициенте защиты (что это?) персонажа к коэффициенту атаки (а это что?) противника урон может стать столь малым, что у персонажа будет иммунитет к таким атакам (нигде не раскрыто что это такое). Также защита может действовать и на особые эффекты атак противников. *Повышается с использованием одежды.*
* **Точность** &mdash; показатель, влияющий на вероятность персонажа попасть по противнику при совершении атаки, и соответственно нанести урон. Повышается использованием "профильного" (?) оружия (дает больший шанс попадания по противнику).
* **Ловкость** &mdash; показатель, влияющий на вероятность персонажа увернуться от атаки противника. Так же влияет на скорость атак персонажа *(скорость атак не определена в документе!)*.
* **Интеллект** &mdash; показатель, определяющий скорость регенерации маны**.
* **Инициатива** &mdash; показатель, определяющий место персонажа в очерёдности ходов в бою.

Данные характеристики можно временно повысить соответствующими зельями.

**Замечание 1**: *Изначально здесь было замечание про точность. Каюсь, я не внимательно прочитал зачем нужна ловкость и то замечание снимается. Теперь просто хочу спросить, можно ли сделать, чтобы была характеристика повышающая урон заклинаний, или урон заклинаний зависит только от уровня заклинания? Кстати в документе про это ничего нет*.

*Формул расчётов работы характеристик нет.*

### Вычисляемые
* **Урон** &mdash; показатель, определяющий количество очков здоровья, отнимаемых у врага при попадании по нему атаки персонажа. Зависит от **Силы** персонажа.
* **Шанс попасть по врагу** &mdash; показатель, определяющий вероятность попадания по врагу при совершении персонажем атаки. Зависит от **Точности** персонажа.
* **Шанс уклониться от атаки** &mdash; показатель, определяющий вероятность попадания атаки врага по персонажу. Зависит от **ловкости** персонажа.
* **Гарантированное попадание** &mdash; атрибут удара. От удара, который гарантированно попадает нельзя увернуться.

### Изначальные значения характеристик
Изначальные значения характеристик у представителей разных рас различаются. Изначальные значения характеристик так же зависят от пола персонажа. [Таблицы исходных значений характеристик](https://github.com/uonline/universe/blob/master/%D0%9D%D0%B0%20%D1%83%D1%82%D0%B2%D0%B5%D1%80%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5/%D0%94%D0%B8%D0%B7%D0%B0%D0%B9%D0%BD-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82/%D1%80%D0%B0%D1%81%D1%8B%20%D1%85%D0%B0%D1%80%D0%B0%D0%BA%D1%82%D0%B5%D1%80%D0%B8%D1%81%D1%82%D0%B8%D0%BA%20%D0%B4%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0.png)

### Распределение очков характеристик
При создании персонажа игроку дается возможность распределить определенное количество (какое?) **очков характеристик** по **Дополнительным параметрам** персонажа.

С каждым новым уровнем игроку дается возможность распределить определенное количество (какое?) **очков характеристик** по **Дополнительным параметрам** персонажа.

Так же при повышении уровня персонажа **все характеристики** автоматически повышаются на незначительные значения (формулы прироста ниже).

### Типы урона
Разделения на магический и физический урон в игре нет. Обоснование:

_я считаю, что магический урон от физического (ближнего или дальнего боя) отличается тем, что он не формируется путем взаимодействия материи и материи, а путем взаимодействия магической силы и материи. однако последствия одинаковы - хотя природа различна, но конечный результат такой, что персонаж получает урон от нечто, что есть материальным результатом воплощения магической силы. то есть,из силы формируется нечто. что именно - в зависимости от характера магии. урон холодом, огнем, яд &mdash; вне зависимости что есть это такое, оно наносит урон такой же, как если бы персонаж пострадал от огненной стрелы лучника или попал в облако яда. борьба идет не с причиной, а с последствиями. тогда при разделении на физическую и магическую борьба имела бы вид в плане уничтожения оружия противника, к примеру, меча воина или посоха мага, либо каким еще иным способом привести к неспособности сражаться._

**Замечание 2**: *Не очень понятно есть ли всё таки у персонажа сопротивления к огню, холоду, яду и прочему. Или в игре существует только один тип урона, т.е. урон от удара меча, попадания огненной стрелы или сосульки заклинания "Ледяной шип" снижается параметром* **Защита**.

**Замечание 3**: *нигде не раскрывается понятие* **урон**. *Ещё встречается понятие* **атака**, *также не раскрытое. Я предложил свои версии понятий*.

### Инициатива
пока что при условии высшей инициативы  право первого хода получит этот игрок. инициатива 22 к 11 - идти первым будет персонаж, у кого 22 инициативы. я напишу ниже как быть в случае командного боя.

### Механика взаимодействия характеристик?
изначально я предполагал, что пока что пусть 1 дамага снимается при 1 защиты. однако что делать при одинаковом соотношении дамага и защиты... и! я захотел внести элемент рандома: все понимают, что вот стандартно бить на, скажем 13 урона - ну нереально это. пожтому всегда будет уронв в диапазоне. скажем, 10-14. и защита в таком же диапазоне (ориентировочный урон +/- 2 едницы, начальный же урон на первом уровне у песонажа, соответственно не может быть ниже 3, как и защита).  таким образом, что при рандомном уроне/защите вероятность, что в одинаковых статистиках у игроков не будет тупого долбежа по мышке, пока кто-то не сдастся или не выйдет из боя, свернув окно. в случае различных характеристик, когда, например, атака превышает защиту - понятно у кого вероятность выигрыша больше. при обратном условии - тоже все понятно.
аналогичная ситуация с "ловкостью" и "точностью". минимальный начальный параментр - 3, допустимые расхождения от ориентировочного показателя при применении - +/- 2.

казалось бы: зачем же указывать точный параметр для игрока, если применение все равно не может быть статичным, а программно и так замутим, так что пусть и указываются вероятные значения. а потому, что для игрока знание точного параметра будет очень важным: в зависимости от величины параметра он впоследствии сможет (или не сможет) не просто использовать, но и поднимать в инвентарь определенные вещи. эти вещи и будут также влиять на стиль боя.  вот и будет в характеристиках персонажа писаться "урон" (с указанием диапазона), "защита" (с указанием диапазона), "уклонение" (с указанием диапазона либо без него - как сподручнее), "попадание" (с указанием диапазона либо без него - как сподручнее), "инициатива" (без указания диапазона),  а вот в меню характеристик - "сила", "защита", "ловкость", "точность", "инициатива", "здоровье", "мана", "энергия", "интеллект". я, конечно, думаю на предмет того, что, а стоит ли энергию делать таким параметром, на который можно распределять очки? в таком случае пускай будет в окне характеристик персонажа, но не появляется в окне улучшений - будет автоматически на 10-20 единиц улучшаться при повышении уровня... но я подумаю еще.

*Я честно прочитывал эти два абаза не один раз, но так и не понял, что там написано*.

## Формулы в которых используются характеристики

### Атака
**Атака** &mdash; действие, которое юнит может совершить в бою. В процессе атаки, атакующий юнит наносит противнику удар/серию ударов (в зависимости от оружия). В случае попадания удара по противнику, атака считается успешной и противник получает урон. Вероятность успешной атаки зависит от значений параметров **Шанс попадания** атакующего и **Шанс уклониться** атакуемого. Величина потерянного здоровья атакуемого зависит от значений параметров **Урон** атакующего и **Защита** атакуемого.

### Формулы атаки (ориентировочные)

Формула расчёта попадания удара следующая:

1. Проверка шанса гарантированного попадания исходя из Точности атакующего;
* Если первая проверка провалилась (т.е. гарантированное попадание не сработало), то проверяем шанс цели увернуться, зависящий от её Ловкости.
* Если вторая проверка провалилась (т.е. цель не увернулась, и попадание произошло), то проверяем по какой части цели мы попадаем. Вероятности по попаданиям по частям цели есть в частности здесь.

Следовательно: качать Ловкость и Точность должно иметь смысл только до определённого предела, чтобы проценты гарантированного попадания/уворота были в пределах 15-40%.

Взято [отсюда](https://github.com/uonline/universe/issues/240);

Конечный урон по врагу от удара при атаке **Dr**:

* **Dr** = (**D** - **A**)/2
 * **Dr** - урон который получит враг в результате удара, т.е. значение которое будет вычтено из его параметра **Здровье**;
 * **D** - урон персонажа (атакующего);
 * **A** - защита врага (атакуемого);

Урон юнита **D**:
* **D** = **S** + **D**, где:
 * **S** - значение параметра **Сила** юнита;
 * **D** - значение урона оружия;

Защита юнита **A**:
* **A** = **Df** + **Da**, где:
 * **Df** - значение параметра **Защита** юнита;
 * **Da** - значение параметра защиты части доспеха, на которую приходится удар;

(параметр силы персонажа + параметр урона от оружия - параметр защиты персонажа - параметр защиты от доспеха)/2 = нанесенный урон.


### Формулы автоматического прироста характеристик с ростом уровня

изначально - пусть показатель здоровья будет равен 1000, а мана - 500. каждый новый уровень показатель здоровья пускай увеличивается на 40, маны - соответственно на 20. каждое новое очко уровня будет давать +10 к здоровью и +5 к мане соответственно. показатель "интеллект" с каждым уровнем будет восстанавливать на 0.1 маны больше за одну секунду, а распределение очков уровня - также +0.1 к скорости восстановления. энергия пускай пока будет 100.
итак, имеем начальный вид характеристик персонажа:

здоровье - 1000
мана - 500
энергия - 100
сила - 50
защита - 50
ловкость - 50
точность - 50
интеллект - 50
инициатива - 20
эти характеристики будут давать такой эффект:
урон: 45-55
защита: 55-45
вероятность начать битву - 50% (в случае совпадания показателя инициативы)
вероятность увернуться от удара - 50% (в том же самом случае для показателя ловкости)
вероятность нанести удар - 50% (в том же самом случае для показателя точности)
восстановление маны - 0.5 единиц в секунду (по формуле расчета: показатель характеристики делится на 10)

* **Здоровье** &mdash; 1000, при повышении уровня +40 автоматически, при каждом очке уровня +10
* **Мана** &mdash; 500, при повышении уровня +20 автоматически, при каждом очке уровня +5
* **Энергия** &mdash; 100, при повышении уровня +10 автоматически, при каждом очке уровня +5
* **Сила** &mdash; 50,при повышени уровня +5 автоматически, при каждом очке уровня +3
* **Защита** &mdash; 50, при повышении уровя +5 автоматически, при каждом очке уровня +3
* **Ловкость** &mdash; 50, при повышении уровня +5 автоматически, при каждом очке уровня +3
* **Точность** &mdash; 50, при повышении уровня +5 автоматически, при каждом очке уровня +3
* **Интеллект** &mdash; 50, при повышении уровня +5 автоматически, при каждом очке уровня +3
* **Инициатива** &mdash; 20, при повышении уровня +2 автоматически, приждом очке уровня +2

### Уточнения
* * &ndash; Личный параметр - НЕ МОЖЕТ БЫТЬ УВЕЛИЧЕН ВЕЩАМИ!;
* ** &ndash; ЛИЧНЫЙ ПАРАМЕТР - НЕ МОЖЕТ БЫТЬ УСИЛЕН ВЕЩАМИ И ЗЕЛЬЯМИ (исключение - изучение книг)